# 数据库设计报告

<!-- vscode-markdown-toc -->
* 1. [文档介绍](#)
	* 1.1. [文档目的](#-1)
	* 1.2. [文档范围](#-1)
	* 1.3. [读者对象](#-1)
* 2. [ 数据库环境说明](#-1)
* 3. [ 逻辑设计](#-1)
* 4. [ 物理设计](#-1)
	* 4.1. [ 用户表](#-1)
	* 4.2. [ 管理员表](#-1)
	* 4.3. [ 事务表](#-1)
	* 4.4. [ 店铺表](#-1)
	* 4.5. [ 订单表](#-1)
	* 4.6. [订单中商品](#-1)
	* 4.7. [ 收货人表](#-1)
	* 4.8. [商品表](#-1)
	* 4.9. [收藏店铺表](#-1)
	* 4.10. [ 收藏商品表](#-1)
	* 4.11. [ 商品评价表](#-1)
	* 4.12. [ 购物车表](#-1)
	* 4.13. [ 分类表](#-1)
* 5. [ 安全性设计](#-1)
	* 5.1. [防止用户直接操作数据库的方法](#-1)
	* 5.2. [用户帐号密码的加密方法](#-1)
	* 5.3. [ 角色与权限](#-1)
* 6. [优化](#-1)
* 7. [数据库管理与维护说明](#-1)

<!-- /vscode-markdown-toc -->

---

##  1. <a name=''></a>文档介绍

###  1.1. <a name='-1'></a>文档目的

本文档的目的是设计《网上购物系统》中各项功能和非功能性需求实现时所需要的数据库，并可以此数据库为根据实现具体的数据存储。同时为详细设计人员提供设计依据，其他本项目组的开发人员也可参阅。

###  1.2. <a name='-1'></a>文档范围

本文档包含一下几个部分：

1.  文档介绍。
1.  数据库环境说明。
1.  数据库的命名规则。
1.  逻辑设计。
1.  物理设计。
1.  安全性设计。
1.  优化。
1.  数据库管理与维护说明。

###  1.3. <a name='-1'></a>读者对象

《网上购物系统数据库设计报告》的阅读对象为：

- 对相关业务技术和总体方案作出决策的管理人员和质量管理人员。
- 对本《数据库设计报告》进行评审和确认的有关业务、技术人员。 
- 参加详细设计，测试设计阶段工作的全体设计人员。
- 《网上购物系统》项目组，其他有权需要调用本文档的人员。

##  2. <a name='-1'></a> 数据库环境说明

运行的目标操作系统为Windows 10。

采用的数据库系统为Mysql community server 5.0。

设计工具为PowerDesigner15。

数据库编码方式为utf-8，数据库中主要字符的编码格式为utf-8。

##  3. <a name='-1'></a> 逻辑设计

![实体联系图](../images/OnlineShoppingSystem(E-R).jpg)

##  4. <a name='-1'></a> 物理设计

| 表名  | 英文名 | 功能说明 |
| ------ | ------- | ------------- |
| 用户表  | user | 保存用户信息  |
| 管理员表| admin | 保存管理员信息 |
| 事务表  | transaction | 记录事务信息  |
| 店铺表  | shop | 记录店铺信息  |
| 订单表  | order | 记录订单信息  |
| 收货人表 | receiver | 记录收货信息  |
| 商品表  | goods | 保存商品所有信息  |
| 收藏店铺表  | favorite_shop  | 记录收藏夹中的店铺信息 |
| 收藏商品表  | favorite_goods | 记录收藏夹中的商品信息 |
| 商品评价表  | goods_evaluate | 记录评价信息 |
| 购物车表  | shopping_car | 保存购物车信息 |
| 订单中商品表  | goods_in_order  | 记录订单中的商品信息 |
| 分类表  | class | 提供两层分类 |


###  4.1. <a name='-1'></a> 用户表

| 列名   | 英文名 | 数据类型（精度范围）     |  空/非空  | 说明 |
| ---- | ---  | --- |---|---|
| 用户ID | user_id	  | 整形  		  	     | 非空 | 主键，自增 |
| 手机号 | phone      |  字符型(11位)  	 | 非空 | 注册/登陆时填写。唯一。    |
| 登录密码 | password | 可变字符型（100位）| 非空 | 注册/登陆时填写。字母、数字、'-'、'_'的组合，不少于 6 个字符、不超过 20 个字符。	 | 
| 昵称  | username    | 可变字符型（20位） |      |  默认显示手机号    |
| 头像  | photo_name  | 可变字符型（20位）  |       |	图片名称，为空时显示默认头像。 |
| 性别  | sex	        | 字符型（4位）      |      | 枚举，男，女，保密三选一 |
| 出生日期 | birthday  | 时间类型  			   |     |    	  |


###  4.2. <a name='-1'></a> 管理员表

| 列名    | 英文名   | 数据类型（精度范围） | 空/非空 | 说明 |
| ---  | --- | --- |---|---|
| 管理员编号 | admin_id  | 整形  		  	     | 非空 | 主键 |
| 登录密码 	| password   | 可变字符型（100位） | 非空 |  不少于6个不多于20个字符 | 
| 昵称      | admin_name | 可变字符型（20位）	 |      |      |


###  4.3. <a name='-1'></a> 事务表

| 列名   | 英文名    | 数据类型（精度范围）   | 空/非空 | 说明 |
| ----  | --- | ---- |---|---|
| 事务编号 | transaction_id    | 		 整形  	            | 非空 | 主键 |
| 事务类型 | transaction_type  |   字符型（10位） | 非空 | 事务类型域,开店申请等 | 
| 事务状态 | transaction_status |  字符型（10位）| 非空  | 事务状态域 |
| 内容描述 | content          | 可变字符型（300位      ）| 非空  |     |
| 提交人 |  user_id           |  整形	                 | 非空  | 用户编号 |
| 提交时间 | commit_time      | 时间类型			           |  非空 |     |
| 处理人 | operator           |    整形	                | 非空   | 管理员编号  |
| 处理时间 | operate_time      | 时间类型		             | 非空   |      |
| 处理备注 | comment           | 可变字符型（50位）	       |      |      |


###  4.4. <a name='-1'></a> 店铺表

| 列名    | 英文名    | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ---- | ---- |---|---|
| 店铺编号 | registration_id |	字符型（15位） | 非空 | 主键，即有效注册号 |
| 店铺名称 | name	| 可变字符型（30位）        |      |      |
| 绑定用户 | user_id |	整形                 | 非空  | 用户编号 | 
| 店铺地址  | address | 可变字符型（100位  ）	|       |     |
| 联系方式  | phone | 字符型（11位）         | 非空  | 用户手机号 |
| 店铺描述  | describe | 可变字符型（300位）	|     | 未设置则显示默认值--"暂无描述"。 |
| 公告  | announcement | 可变字符型（200位） |      | 未设置则显示默认值--"暂无公告"。 |
| 用户评价总和 | credit_rating |  定点数（2，1）|       | 店铺评分，初始为0 |
| 评价人数  | evaluate_number |	整形          |      |        |        


###  4.5. <a name='-1'></a> 订单表

| 列名   | 英文名   | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ---- | ---- |---|---|
| 订单编号 | order_id | 		 整形  	       | 非空 | 主键，唯一。提交订单时系统自动生成。16 位数字，从 1 开始，不够十六位使用前导 0 补足 |
| 订单状态 | status	| 	订单状态域         | 非空  |        | 
| 运单号   | tracking_number | 整形       |      | 用户下单时为空，商家发货时必须填写运单号。12 位纯数字。|
| 支付方式  | pay_method |  字符型（8位）  |      | 枚举。货到付款/在线支付   |
| 下单时间  | order_time | 时间类型        | 非空  | 精确到秒    |
| 完成时间  | complete_time |	时间类型     |      |      |
| 备注    	| comment |	可变字符型（100位） |     |        | 
| 总金额    | total | 定点数（10.2）	     |    |     |
| 用户编号  | user_id  | 整形              | 非空  |     |
| 店铺编号  | registration_id | 字符型（15位）|      |      |
| 收货人编号	| receiver_id  |	整形          | 非空  | 收货信息  |
| 评价编号 | comment_id	| 整形  	           | 非空 | 外键  |


###  4.6. <a name='-1'></a>订单中商品

| 列名  | 英文名   | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ----- | ----- |---|---|
| 订单编号 | order_id |		  整形  	         | 非空 |  主键 外键   |
| 商品编号 | goods_id | 		整形             | 非空 |  主键 外键  |
| 商品数量 | goods_num | 		整形             | 非空 |      |
| 交易时成本	| cost	 |   定点数（10.2）      | 非空  |      | 
| 成交价  | actual_price |  定点数（10.2）   	| 非空   |     |


###  4.7. <a name='-1'></a> 收货人表

| 列名  | 英文名    | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ---- | ---- |---|---|
| 收货人编号 | receiver_id  | 	 整形  	    | 非空 | 主键 |
| 用户编号   | user_id	|	整形             | 非空 |      |
| 收货人姓名| name | 可变字符型（20位）	   |  非空 |  由中文、英文字母组成，不能含有其他字符。|
| 收货地址  | address |可变字符型（100位）  | 非空  |    	 |
| 手机号    | phone | 字符型（11位）	 	    | 非空  |        |
| 已使用次数 | used_times  | 整形        	| 非空 | 用户不可见，默认为0   |


###  4.8. <a name='-1'></a>商品表

| 列名   | 英文名     | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ----- | ------ |---|---|
| 商品编号 | goods_id	|	 整形  	           | 非空 | 主键 |
| 店铺编号 | registration_id	| 整形       | 非空 |      |
| 商品名称 | name	|	 可变字符型（20位）      | 非空 |     |
| 分类   	| class	| 整形                  | 非空   | 分类编号 | 
| 预览图  | preview | 可变字符型（20位）	    |        | 若为空，则显示默认商品图 |
| 描述  | describe   | 可变字符型（300位）   |        |        |
| 进价  | cost   |   定点数（10.2）	       | 非空    |        |
| 售价  | price  |  定点数（10.2）          | 非空    |        |
| 销量  | sales  |    整形	               |  非空    | 默认为0 |
| 库存  | inventory	|	整形                 |  非空    | 默认为0  |
| 打折截止时间 | discount_deadline |  时间类型  |  非空    | 默认  "2000-01-01 00:00:00"  |
| 打折比例    | discount_rate	|	定点数（4.2） |      |        |
| 状态 | status    | 布尔型              |  非空     | 默认false   |


###  4.9. <a name='-1'></a>收藏店铺表

| 列名   | 英文名    | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ---- | ---- |---|---|
| 用户编号 | user_id	|	 整形  	           | 非空 |  主键 外键 |
| 店铺编号 | registration_id	|	 整形  	   | 非空 | 主键 外键  |


###  4.10. <a name='-1'></a> 收藏商品表

| 列名   | 英文名    | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ----- | ---- |---|---|
| 用户编号 | user_id	|		 整形  	          | 非空 |  主键 外键      |
| 商品编号 | goods_id	|	 整形  	          | 非空 |  主键 外键      |


###  4.11. <a name='-1'></a> 商品评价表

| 列名   | 英文名     | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ----- | ----- |---|---|
| 评价编号 | comment_id	| 整形  	           | 非空 | 主键 |
| 用户编号 | user_id		| 整形  	           | 非空 |      |
| 商品编号 | goods_id		| 整形  	           | 非空 |      |
| 订单编号 | order_id   |	整形  	           | 非空 | 外键 |
| 评价内容 | content		| 可变字符型（100位） |      |      |
| 评价分值 | comment_score	| 整形  	       |    | 0~5,5个评分等级 |
| 评价时间 | comment_time		| 时间类型       |    |        |


###  4.12. <a name='-1'></a> 购物车表

| 列名   | 英文名       | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ---- | --- |---|---|
| 商品数量 | goods_num | 		整形         | 非空 |      |
| 商品编号 | goods_id	|	 整形  	         | 非空 | 主键 外键 |
| 用户编号 | user_id  | 		 整形  	     | 非空 | 主键 外键 |


###  4.13. <a name='-1'></a> 分类表

| 列名    | 英文名     | 数据类型（精度范围）   | 空/非空 | 说明 |
| -------  | ---- | --- |---|---|
| 分类编号  | class_id	|	 整形  	          | 非空 | 主键   |
| 一级分类  | level_one	|	 字符型（10位）    | 非空 | 大分类 |
| 二级分类  | level_two	|	 字符型（10位）    | 非空 | 细分   |


##  5. <a name='-1'></a> 安全性设计

提高软件系统的安全性应当从“管理”和“设计”两方面着手。这里仅考虑数据库的安全性设计。

###  5.1. <a name='-1'></a>防止用户直接操作数据库的方法

一般用户只能用帐号登陆到网站或APP，通过网站或APP访问数据库，而没有其它途径操作数据库。

###  5.2. <a name='-1'></a>用户帐号密码的加密方法

尝试对用户帐号的密码进行加密处理，确保在任何地方都不会出现密码的明文。

###  5.3. <a name='-1'></a> 角色与权限

如无特别说明，只有管理员可以查看各表的编号。
商家同时具有用户的所有权限。

<table border="1">
<tr>
  <th>角色</th>
  <th>可以访问的表与列</th>
  <th>操作权限</th>
</tr>
<tr>
  <th rowspan="3">游客</th>
  <td>商品表中的：除了进价</td>
  <td>检索</td>
</tr>
<tr>
  <td>分类表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>店铺表所有列</td>
  <td>检索</td>
</tr>			<!--游客表结束-->

<tr>
  <th rowspan="12">用户</th>
  <td>商品表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>分类表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>店铺表所有列</td>
  <td>检索</td>
<tr>
  <td>订单表所有列</td>
  <td>检索  </td>
</tr>
<tr>
  <td>订单表：支付方式，收货人编号</td>
  <td>更新  </td>
</tr>
<tr>
  <td>购物车表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>用户表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>收货人表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>收藏商品表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>收藏店铺表所有列</td>
  <td>更新</td>
</tr>    	
<tr>
  <td>事务表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>事务表中的：事物类型，内容描述</td>
  <td>更新</td>
</tr>
<!--用户表结束-->

<tr>
  <th rowspan="3">商家</th>
  <td>商品表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>店铺表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>订单表所有列</td>
  <td>更新</td>
</tr>    	<!--商家表结束-->

<tr>
  <th rowspan="13">管理员</th>
  <td>收货人表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>收藏店铺表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>收藏商品表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>商品评价表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>购物车表所有列</td>
  <td>检索</td>
</tr>
<tr>
  <td>订单表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>订单中商品表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>商品表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>管理员所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>事务表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>店铺表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>用户表所有列</td>
  <td>更新</td>
</tr>
<tr>
  <td>分类表所有列</td>
  <td>更新</td>
</tr>    	<!--管理员表结束-->

</table>

##  6. <a name='-1'></a>优化

本次数据库设计暂且不进行第三范式规范，另外也不提供优化处理。

##  7. <a name='-1'></a>数据库管理与维护说明

不提供数据库管理与维护。